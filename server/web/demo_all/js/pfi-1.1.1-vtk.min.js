this.pfi=function(t,e,i,n,s){"use strict";function o(t){throw alert(t),Error(t)}function a(){}return e&&e.querySelector||o("Not support browser."),n||o("jQuery not found."),function(){function t(t){var e,i,n=[],s=-1,o={},a=p;if(t.hasOwnProperty){for(i in t)t.hasOwnProperty(i)&&(o[i]=!0,n[++s]=i);for(e=a.length;e--;)o[i=a[e]]!==!0&&t.hasOwnProperty(i)&&(n[++s]=i)}else for(i in t)n[++s]=i;return n}function e(t){return"[object Array]"===Object.prototype.toString.call(t)}function i(){return+new Date}function n(t,e){for(var i=0,n=this.length,s=Array(n);n>i;++i)i in this&&(s[i]=t.call(e,this[i],i,this));return s}function s(t,e){for(var i=0,n=this.length;n>i;++i)i in this&&t.call(e,this[i],i,this)}function o(t,e){for(var i=0,n=this.length;n>i;++i)if(i in this&&t.call(e,this[i],i,this))return!0;return!1}function a(t,e){for(var i=0,n=this.length;n>i;++i)if(i in this&&!t.call(e,this[i],i,this))return!1;return!0}function r(t,e){var i=e||0,n=this.length;for(i=0>i?i+n:i;n>i;++i)if(i in this&&this[i]===t)return i;return-1}function l(t,e){var i=e,n=this.length;for(i=0>i?i+n+1:n;--i>=0;)if(i in this&&this[i]===t)return i;return-1}function c(t,e){for(var i,n=[],s=0,o=this.length;o>s;++s)s in this&&(i=this[s],t.call(e,i,s,this)&&n.push(i));return n}function u(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function h(t){var e,i=this,n=Array.prototype.slice.call(arguments,1),s=function(){};return e=function(){return i.apply(this instanceof s?this:t,Array.prototype.concat.call(n,Array.prototype.slice.call(arguments)))},s.prototype=i.prototype,e.prototype=new s,e}var p=["constructor","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","toLocaleString","toString","valueOf"];Object.keys||(Object.keys=t),Array.isArray||(Array.isArray=e),Date.now||(Date.now=i),Array.prototype.map||(Array.prototype.map=n),Array.prototype.forEach||(Array.prototype.forEach=s),Array.prototype.some||(Array.prototype.some=o),Array.prototype.every||(Array.prototype.every=a),Array.prototype.indexOf||(Array.prototype.indexOf=r),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=l),Array.prototype.filter||(Array.prototype.filter=c),String.prototype.trim||(String.prototype.trim=u),Function.prototype.bind||(Function.prototype.bind=h)}(),a.pp=function(){a.debug!==!1&&t.console&&console.log&&console.log.apply(console,arguments)},a.extend=function(t){var e,i,s,o,r,l,c,u=arguments,h=1,p=u.length;for(null==t&&(t={});p>h;++h)if(e=u[h],e&&"object"==typeof e)for(i=Object.keys(e),s=0,o=i.length;o>s;++s)r=i[s],l=t[r],c=e[r],t!==c&&(t[r]=c&&n.isPlainObject(c)?a.extend(l&&n.isPlainObject(l)?l:{},c):c&&n.isArray(c)?a.extend([],c):c);return t},a.uid=function(){return"pfi"+(0|60466176*Math.random()).toString(36)+Date.now().toString(36)},function(e,i){function n(){}i.extend(n,{tmpl:t.Hogan?function(t){var e=Hogan.compile(t);return function(t){return e.render(t)}}:function(){o("Template engine not found.")},$tmpl:function(t){var i=this.tmpl(t);return function(t){return e(i(t))}},label:function(t){return t.replace(/[\s_:]+/g," ").replace(/^\s+|\s+$/g,"").replace(/\b(?:id\b|.)/gi,function(t){return t.toUpperCase()})},separate:function(t,e,i){return(""+t).replace(RegExp("\\B(?=(?:\\d{"+(i||3)+"})+$)","g"),e||",")}}),i.extend(n.prototype,{on:function(){return this.$||(this.$=e([this])),this.$.on.apply(this.$,arguments)},off:function(){return this.$||(this.$=e([this])),this.$.off.apply(this.$,arguments)},fire:function(){return this.$||(this.$=e([this])),this.$.trigger.apply(this.$,arguments)}}),i.UI=n}(i,a),function(t,e){var i=e.bootstrap||(e.bootstrap={});i.define=function(e,i,n,s){"function"===t.type(n)&&(s=n,n=null),"function"!==t.type(s)&&(s=null),t.fn[e]=function(n){var o=arguments,a=this;return this.each(function(){var r=t(this),l=r.data(e),c="object"==typeof n&&n;if(l||(l=new i(this,c||{}),r.data(e,l)),"string"==typeof n){var u=l[n].apply(l,Array.prototype.slice.call(o,1));if(void 0!==u)return a=u,!1}else c&&l.setup?l.setup(c):s&&s.apply(this,o)}),a},t.fn[e].defaults=n||{},t.fn[e].Constructor=i},i.modal=function(e){var i=t('<div class="modal hide fade"><div class="modal-header"><a href="javascript:void 0" class="close" data-dismiss="modal">&times;</a><h3></h3></div><div class="modal-body"></div></div>');return e&&(("object"!=typeof e||e.jquery)&&(e={body:e}),"header"in e&&i.find(".modal-header h3").append(e.header),"body"in e&&i.find(".modal-body").append(e.body),"footer"in e&&t("<div>").addClass("modal-footer").append(e.footer).appendTo(i)),i},i.alert=function(e){var i=t('<div class="alert fade in"><a href="javascript:void 0" class="close" data-dismiss="alert">&times;</a></div>');return e&&(("object"!=typeof e||e.jquery)&&(e={body:e}),"header"in e&&t("<strong>").append(e.header).appendTo(i),"body"in e&&i.append(e.body)),i}}(i,a),function(t){function e(t,e){function c(t,i,l,c,u){var d,y,g,x=f[u]||0;switch(l=l?s(l,10):null,null===l&&u in p&&(l=p[u]),u){default:d=u;break;case"A":case"a":d=h[u][e.getDay()];break;case"h":u="b";case"B":case"b":d=h[u][e.getMonth()];break;case"C":d=0|e.getFullYear()/100;break;case"d":case"e":d=e.getDate();break;case"g":d=n(e)%100;break;case"G":d=n(e);break;case"H":case"k":d=e.getHours();break;case"I":case"l":d=e.getHours()%12||12;break;case"j":d=o(e);break;case"L":case"N":d=e.getMilliseconds();break;case"M":d=e.getMinutes();break;case"m":d=e.getMonth()+1;break;case"P":case"p":d=h[u][12>e.getHours()?0:1];break;case"S":d=e.getSeconds();break;case"s":d=0|+e/1e3;break;case"U":d=0|(o(e)+6-e.getDay())/7;break;case"u":d=e.getDay()||7;break;case"V":d=a(e);break;case"W":d=r(e);break;case"w":d=e.getDay();break;case"Y":d=e.getFullYear();break;case"y":d=e.getFullYear()%100;break;case"Z":y=/\(([^)]+)\)$/.exec(""+e),d=y?y[1]:"";break;case"z":c=c.length,g=0|60*e.getTimezoneOffset(),d=g>0?"-":"+",g=Math.abs(g),d+=("0"+(0|g/3600)).slice(-2),g%=3600,c>0&&(d+=":"),d+=("0"+(0|g/60)).slice(-2),c>1&&(d+=":"+("0"+g%60).slice(-2))}return d+="",~i.indexOf("^")&&(d=d.toUpperCase())||~i.indexOf("#")&&(d=d.toLowerCase()),~i.indexOf("-")&&(l=0),l&&l>d.length&&(~i.indexOf("_")&&(x=" ")||~i.indexOf("0")&&(x=0),d=Array(l-d.length+1).join(x)+d),d}return e||(e=Date.now()),t=t.replace(l,i),t.replace(u,c)}function i(t,e){return c[e]}function n(t){var e=t.getFullYear(),i=a(t),n=r(t);return n>i?++e:0===n&&i>=52&&--e,e}function o(t){var e=t-new Date(t.getFullYear(),0,1);return(0|e/1e3/60/60/24)+1}function a(t){var e=r(t),i=new Date(t.getFullYear(),0,1).getDay();return e+=i>4||1>=i?0:1,53===e&&4>new Date(t.getFullYear(),11,31).getDay()?e=1:0===e&&(e=a(new Date(t.getFullYear()-1,11,31))),e}function r(t){var e=o(t),i=7-(t.getDay()||7);return 0|(e+i)/7}var l=/%[#0_^-]*\d*:*([cDFnRrTtvXx])/g,c={c:"%a %b %e %H:%M:%S %Y",D:"%m/%d/%y",F:"%Y-%m-%d",n:"\n",R:"%H:%M",r:"%I:%M:%S %p",T:"%H:%M:%S",t:"	",v:"%e-%^b-%4Y",X:"%H:%M:%S",x:"%m/%d/%y"},u=/%([#0_^-]*)(\d*)(:*)([a-z%])/gi,h={A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],P:["AM","PM"],p:["am","pm"]},p={C:2,d:2,e:2,g:2,H:2,I:2,j:3,k:2,L:3,l:2,M:2,m:2,N:9,S:2,U:2,W:2,V:2,y:2},f={e:" ",k:" ",l:" "};t.strftime=e}(a.date||(a.date={})),function(t){function e(t){function e(t,e){return t=t?s(t,10):l++,r>t?a[t]:e}function o(t,i,o,a,r,l,c,u,h,p){if("%"===p)return"%";a&&(l=s(l||e(r,0),10)),c&&(h||(h="."===c?0:e(u,0)),h=s(h,10));var f,d=n[p],y=e(i,""),g=~o.indexOf("-"),x=~o.indexOf("0"),m="";if(0>l&&(l=-l,g=!0),d)if(8&d)16&d&&(y=JSON.stringify(y)),y+="",c&&(y=y.slice(0,h));else{var v,b,k=~o.indexOf("#");1&d?(y=s(y,10),0>y&&(y=-y,b="-"),v=16&d?16:32&d?2:64&d?8:void 0,v&&k&&y&&(m=16&d?"0x":32&d?"0b":"0",4&d&&(m=m.toUpperCase())),y=y.toString(v),h&&h>y.length&&(y=Array(h-y.length+(m&&64&d?0:1)).join("0")+y)):(y=parseFloat(y),0>y&&(y=-y,b="-"),isFinite(y)?(y=2!==d||h?y[16&d?"toPrecision":32&d?"toExponential":"toFixed"](h):""+y,k?/^\d+\./.test(y)||(y=y.replace(/^(\d+)/,"$1.")):16&d&&(y=y.replace(/\.0*$/,""))):y=""+y),b||(b=~o.indexOf("+")?"+":~o.indexOf(" ")?" ":""),m=b+m,y=y[4&d?"toUpperCase":"toLowerCase"]()}else y="number"!=typeof y||0>y?(""+y).charAt(0):String.fromCharCode(y);return l&&l>y.length+m.length?(f=l-m.length-y.length+1,f=Array(f).join(x?"0":" "),y=g?m+y+f:x?m+f+y:f+m+y):y=m+y,y}var a=arguments,r=a.length,l=1;return t.replace(i,o)}var i=/%(?:(\d+)\$)?([ #0+-]*)(\*(?:(\d+)\$)?|(\d+))?(\.(?:\*(?:(\d+)\$)?|(\d+))?)?([bBdiouxXeEfgGgAcps%])/g,n={d:1,i:1,o:65,x:17,X:21,b:33,B:37,u:1,f:2,g:18,G:22,e:34,E:38,a:66,A:70,p:24,s:8,c:0};t.sprintf=e}(a.text||(a.text={})),function(t,e){var i={},n=function(i,n){this.parent=0===t(i).closest("svg").size()?d3.select(i).append("svg").node():i;var s=this.options=e.extend({size:null,font:{size:12,family:"sans-serif"}},n);this.resize(s.size),this.build(),this.update()};n.prototype.resize=function(e){this.options.size=e?e:{width:s(d3.select(this.parent).attr("width"),10)||t(this.parent).parent().width(),height:s(d3.select(this.parent).attr("height"),10)||t(this.parent).parent().height()},d3.select(this.parent).attr(this.options.size)},n.prototype.build=function(){this.container=d3.select(this.parent).append("g").style("font-family",this.options.font.family).style("font-size",this.options.font.size+"px"),n.count=n.count?n.count+1:1,this.id=n.count};var o=function(t,i){n.call(this,t,e.extend({axis:{x:{position:"bottom",scale:null,format:null,ticks:null,label:null,visible:!0,selectable:!1},y:{position:"left",scale:null,format:null,ticks:null,label:null,visible:!0,selectable:!1}},legend:{visible:!0,position:{x:"right",y:"top"},margin:{x:10,y:10},padding:{x:10,y:10},font:{size:12,family:"sans-serif"},mouseover:null,mouseout:null,click:null},groupColor:null,rangeselect:null,mouseover:null,mouseout:null,click:null},i))};e.extend(o.prototype,n.prototype),o.prototype.build=function(){n.prototype.build.call(this),this.data=[];var e="pfi-chart-cilp-"+this.id;this.chartClip=this.container.append("defs").append("clipPath").attr("id",e).append("rect").attr("x",0).attr("y",0),this.selector={container:this.container.append("g").attr("class","pfi-chart-selector"),brush:d3.svg.brush()},this.chart=this.container.append("g").attr("clip-path","url(#"+e+")");var i=this;this.axis={},t.each(this.options.axis,function(e,n){if("x"===e&&"left"===n.position||"x"===e&&"right"===n.position||"y"===e&&"top"===n.position||"y"===e&&"bottom"===n.position||0>t.inArray(n.position,["top","right","bottom","left"]))throw Error("Invalid position for "+e+" axis: "+n.position);var o={};o.position=n.position,o.scale="time"===n.scale?d3.time.scale():d3.scale[n.scale](),o.container=i.container.append("g").attr("class","pfi-chart-axis pfi-chart-"+e),o.line=i.container.append("line").attr("stroke","black").style("shape-rendering","crispEdges"),o.label=i.container.append("text").attr("class","pfi-chart-label pfi-chart-"+e).text(n.label).attr("text-anchor","middle").attr("dominant-baseline","central"),o.labelOffset=10,o.visible=n.visible,o.drawer=d3.svg.axis().scale(o.scale).orient(n.position),n.format&&o.drawer.tickFormat(d3.format(n.format)),null!=n.ticks&&o.drawer.ticks(s(n.ticks,10)),i.axis[e]=o,n.selectable&&i.selector.brush[e](o.scale)}),this.legend=i.container.append("g").attr("class","pfi-chart-legend").style("fill-opacity",0).style("stroke-opacity",0),this.legend.append("rect").style("stroke","black").style("fill","white").style("stroke-width",1).style("shape-rendering","crispEdges"),this.legend.append("g").attr("class","pfi-chart-names").attr("transform","translate("+this.options.legend.padding.x+","+this.options.legend.padding.y+")"),this.groupColor="string"==typeof this.options.groupColor?function(){return i.options.groupColor}:"function"==typeof this.options.groupColor?this.options.groupColor:d3.scale.category20(),this.innerSize=this.options.size},o.prototype.stackData=function(e,i,n,s,o){var a={},r={};t.each(e,function(e,o){t.each(o,function(t,e){var o=e[i];a[o]||(a[o]={p0:0,n0:0}),e[n]>=0?(e[s]=a[o].p0,a[o].p0+=e[n]):(e[s]=a[o].n0,a[o].n0+=e[n]),r[o]=e[s]+e[n]})}),t.each(e,function(e,n){t.each(n,function(t,e){e[o]=r[e[i]]})})},o.prototype.update=function(e){e|=0;var i=this;this.updateDomain();var n={top:0,right:0,bottom:0,left:0};if(this.axis.x.visible&&(this.axis.x.container.transition().duration(e).call(this.axis.x.drawer),n[this.axis.x.position]=this.axis.x.container.node().getBBox().height+this.axis.x.label.node().getBBox().height+this.axis.x.labelOffset),this.axis.y.visible&&(this.axis.y.container.transition().duration(e).call(this.axis.y.drawer),n[this.axis.y.position]=this.axis.y.container.node().getBBox().width+this.axis.y.label.node().getBBox().height+this.axis.x.labelOffset),this.innerSize={width:this.options.size.width-n.left-n.right,height:this.options.size.height-n.top-n.bottom},this.container.transition().duration(e).attr("transform","translate("+n.left+","+n.top+")"),this.chartClip.transition().duration(e).attr("width",this.innerSize.width).attr("height",this.innerSize.height),this.updateRange(),this.axis.x.visible){var s=this.axis.x.container.transition().duration(e).call(this.axis.x.drawer);"bottom"===this.axis.x.position&&s.attr("transform","translate(0,"+i.innerSize.height+")");var o="top"===this.axis.x.position?-this.axis.x.container.node().getBBox().height-this.axis.x.label.node().getBBox().height/2-this.axis.x.labelOffset:i.options.size.height-this.axis.x.label.node().getBBox().height/2;this.axis.x.label.transition().duration(e).attr("transform","translate("+i.innerSize.width/2+","+o+")"),this.axis.y.scale.ticks&&t.inArray(0,this.axis.y.scale.ticks(1))>=0?this.axis.x.line.transition().duration(e).attr("y1",this.axis.y.scale(0)).attr("y2",this.axis.y.scale(0)).attr("x1",0).attr("x2",this.innerSize.width):this.axis.x.line.transition().duration(e).attr("y1","top"===this.axis.x.position?0:this.innerSize.height).attr("y2","top"===this.axis.x.position?0:this.innerSize.height).attr("x1",0).attr("x2",this.innerSize.width)}if(this.axis.y.visible){var a=this.axis.y.container.transition().duration(e).call(this.axis.y.drawer);"right"===this.axis.y.position&&a.attr("transform","translate("+i.innerSize.width+",0)");var r="left"===this.axis.y.position?-this.axis.y.container.node().getBBox().width-this.axis.y.label.node().getBBox().height/2-this.axis.y.labelOffset:i.options.size.width-this.axis.y.label.node().getBBox().height/2;this.axis.y.label.transition().duration(e).attr("transform","rotate(-90) translate("+-i.innerSize.height/2+","+r+")"),this.axis.x.scale.ticks&&t.inArray(0,this.axis.x.scale.ticks(1))>=0?this.axis.y.line.transition().duration(e).attr("x1",this.axis.x.scale(0)).attr("x2",this.axis.x.scale(0)).attr("y1",0).attr("y2",this.innerSize.height):this.axis.y.line.transition().duration(e).attr("x1","left"===this.axis.y.position?0:this.innerSize.width).attr("x2","left"===this.axis.y.position?0:this.innerSize.width).attr("y1",0).attr("y2",this.innerSize.height)}if(this.container.selectAll(".pfi-chart-axis .tick line").style("stroke","black").style("shape-rendering","crispEdges"),this.container.selectAll(".pfi-chart-axis .domain").style("fill","none").style("stroke","none"),this.selector.container.select(".extent").style("fill-opacity",.25).style("fill","skyblue"),this.selector.brush.x()||this.selector.brush.y()){var l=this.selector.container.call(this.selector.brush).selectAll("rect");this.selector.brush.y()||l.attr("height",this.innerSize.height),this.selector.brush.x()||l.attr("width",this.innerSize.width)}if(this.options.legend.visible&&this.data.length&&this.data[0].name){var c=this.legend.select("g.pfi-chart-names"),u=c.selectAll("text").data(this.data,function(t){return t.name});u.attr("y",function(t,e){return 1.2*e+.8+"em"}),u.enter().append("text").attr("x","1.2em").attr("y",function(t,e){return 1.2*e+.8+"em"}).text(function(t){return t.name}),u.exit().remove();var h=c.selectAll("circle").data(this.data,function(t){return t.name});h.attr("cy",function(t,e){return 1.2*e+.5+"em"}),h.enter().append("circle").on("mouseover",function(t){(i.options.legend.mouseover||i.options.legend.click)&&d3.select(this).style("stroke-opacity",1),i.options.legend.mouseover&&i.options.legend.mouseover(t.name)}).on("mouseout",function(t){d3.select(this).style("stroke-opacity",0),i.options.legend.mouseout&&i.options.legend.mouseout(t.name)}).on("click",function(t){i.options.legend.click&&i.options.legend.click(t.name)}).style("fill",function(t){return t.color}).style("stroke",function(t){return t.color}).style("stroke-width",5).style("stroke-opacity",0).attr("cx","0.4em").attr("cy",function(t,e){return 1.2*e+.5+"em"}).attr("r","0.35em"),h.exit().remove();var p={width:c.node().getBBox().width+2*this.options.legend.padding.x,height:c.node().getBBox().height+2*this.options.legend.padding.y},f={x:"left"!==this.options.legend.position.x?this.innerSize.width-p.width-this.options.legend.margin.x:this.options.legend.margin.x,y:"bottom"!==this.options.legend.position.y?this.options.legend.margin.y:this.innerSize.height-p.height-this.options.legend.margin.y};this.legend.select("rect").attr("width",p.width).attr("height",p.height),this.legend.style("fill-opacity",1).style("stroke-opacity",1).transition().duration(e).attr("transform","translate("+f.x+","+f.y+")")}else this.legend.style("fill-opacity",0).style("stroke-opacity",0)},o.prototype.convertData=function(i,n,s){var o=0;if(!t.isArray(i))throw Error("The data must be a two-dimensional array");if(0===i.length)return[[]];if(t.each(i,function(e,i){if(!t.isArray(i))throw Error("The data must be a two-dimensional array");if(o||(o=i.length),o!==i.length)throw Error("Found inconsistent row size in the data")}),2>o)throw Error("The row size in the data must be more than 1");if(n=e.extend({x:0,y:1,g:2===o?void 0:2},n),void 0===i[0][n.x]||void 0===i[0][n.y]||"number"==typeof n.g&&void 0===i[0][n.g])throw Error("Invalid mapping: x -> "+n.x+", y -> "+n.y+("number"==typeof n.g?", g -> "+n.g:""));var a=[];if(t.each(i,function(t,e){if("number"==typeof n.g&&"string"!=typeof e[n.g])a.push("#"+t+": invalid group");else{var i=s({x:e[n.x],y:e[n.y],g:e[n.g]});i&&a.push("#"+t+": "+i)}}),a.length)throw Error("Invalid data found... "+a.join(", "));var r={},l=[],c=this;return t.each(i,function(t,e){var i,s=e[n.g];void 0===r[s]?(r[s]=l.length,i=[],i.name=s,i.color=c.groupColor(s),l.push(i)):i=l[r[s]],i.push({x:e[n.x],y:e[n.y]})}),l},o.prototype.sortData=function(t,e){var i=e.split(":",2),n=i[0],s="asc"===i[1]?1:-1;return t.sort(function(t,e){return e[n]>t[n]?-s:e[n]<t[n]?s:0})},o.prototype.sliceData=function(e,i,n,s){var o={},a=this.sortData(d3.merge(e),i).filter(function(t){return o[t[n]]?!1:o[t[n]]=!0}).map(function(t){return t[n]}).slice(0,s),r=this,l=d3.set(a);return t.each(e,function(t,e){r.sortData(e,i);for(var s=0;e.length>s;++s)if(!l.has(e[s][n])){e.splice(s);break}}),a},o.prototype.setDrilldown=function(e){var i=[];t.each(e,function(t,e){i.push([t,e])}),this.setData(i)};var a=function(t,i){o.call(this,t,e.extend({axis:{x:{scale:"linear"},y:{scale:"ordinal",position:i.reverse?"right":"left",selectable:!!i.rangeselect}},limit:10,sort:"x:desc",strokeWidth:1,padding:0,barColor:null},i))};e.extend(a.prototype,o.prototype),a.prototype.build=function(){o.prototype.build.call(this),this.barColor="string"==typeof this.options.barColor?function(){return e.options.barColor}:"function"==typeof this.options.barColor?this.options.barColor:null,this.targetYs=[];var e=this;this.selector.brush.on("brushend",function(){var i=e.selector.brush.extent(),n=e.axis.y.scale.rangeBand(),s=[];t.each(e.axis.y.scale.domain(),function(t,o){var a=e.axis.y.scale(o),r=a+n;i[1]>=a&&r>=i[0]&&s.push(o)}),e.options.rangeselect&&s.length&&e.options.rangeselect(s),e.selector.brush.clear(),e.selector.container.call(e.selector.brush)})},a.prototype.update=function(e){o.prototype.update.call(this,e);var i=this,n=this.chart.selectAll("g.pfi-chart-bars").data(this.data,function(t){return t.name});n.transition().duration(e).style("fill-opacity",1).style("stroke-opacity",1),n.enter().append("g").attr("class","pfi-chart-bars").style("fill",function(t){return t.color}).style("stroke","white").style("stroke-width",this.options.strokeWidth),n.exit().transition().duration(e).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove();var s=[];t.each(this.data,function(t,e){s.push(e.name)});var a=n.selectAll("rect").data(Object,function(t){return t.y});a.enter().append("rect").on("mouseover",function(t,e,n){(i.options.mouseover||i.options.click)&&d3.select(this).style("fill-opacity",.8),i.options.mouseover&&i.options.mouseover(void 0===s[n]?{x:t.x,y:t.y}:{x:t.x,y:t.y,g:s[n]})}).on("mouseout",function(t,e,n){d3.select(this).style("fill-opacity","inherit"),i.options.mouseout&&i.options.mouseout(void 0===s[n]?{x:t.x,y:t.y}:{x:t.x,y:t.y,g:s[n]})}).on("click",function(t,e,n){i.options.click&&i.options.click(void 0===s[n]?{x:t.x,y:t.y}:{x:t.x,y:t.y,g:s[n]})}).attr("x",function(t){return i.axis.x.scale(t.x0)}).attr("y",function(t){return i.axis.y.scale(t.y)}).attr("fill",function(t){return i.barColor?i.barColor(t.y):"inherit"}).attr("width",0).attr("height",i.axis.y.scale.rangeBand()).transition().duration(e).attr("x",function(t){return Math.min(i.axis.x.scale(t.x0),i.axis.x.scale(t.x0+t.x))}).attr("width",function(t){return Math.abs(i.axis.x.scale(t.x0+t.x)-i.axis.x.scale(t.x0))}),a.transition().duration(e).attr("x",function(t){return Math.min(i.axis.x.scale(t.x0),i.axis.x.scale(t.x0+t.x))}).attr("y",function(t){return i.axis.y.scale(t.y)}).style("fill-opacity","inherit").style("stroke-opacity","inherit").attr("width",function(t){return Math.abs(i.axis.x.scale(t.x0+t.x)-i.axis.x.scale(t.x0))}).attr("height",i.axis.y.scale.rangeBand()),a.exit().transition().duration(e).attr("width",0).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},a.prototype.updateDomain=function(){this.axis.y.scale.domain(this.targetYs),this.axis.x.scale.domain(d3.extent(d3.merge(d3.merge(this.data.map(function(t){return t.map(function(t){return[t.x0,t.x0+t.x]})}))))).nice()},a.prototype.updateRange=function(){this.axis.x.scale.range("left"===this.axis.y.position?[0,this.innerSize.width]:[this.innerSize.width,0]),this.axis.y.scale.rangeBands([0,this.innerSize.height],this.options.padding/2)},a.prototype.setData=function(t,e){var i={};this.data=this.convertData(t,e,function(t){return i[t.g]||(i[t.g]={}),"number"!=typeof t.x||"string"!=typeof t.y?"(x, y) is not (number, string)":i[t.g][t.y]?"y is duplicated":(i[t.g][t.y]=!0,!1)}),this.stackData(this.data,"y","x","x0","sum");var n=this.options.sort?this.options.sort.match(/^x:(asc|desc)$/):null;this.targetYs=this.sliceData(this.data,n?"sum:"+n[1]:this.options.sort,"y",this.options.limit)},a.prototype.setDrilldown=function(e){var i=[];t.each(e,function(t,e){i.push([e,t])}),this.setData(i)},i.bar=a;var r=function(t,i){o.call(this,t,e.extend({axis:{x:{scale:"ordinal",selectable:!!i.rangeselect},y:{scale:"linear"}},limit:10,sort:"y:desc",strokeWidth:1,padding:0,columnColor:null},i))};e.extend(r.prototype,o.prototype),r.prototype.build=function(){o.prototype.build.call(this),this.columnColor="string"==typeof this.options.columnColor?function(){return e.options.columnColor}:"function"==typeof this.options.columnColor?this.options.columnColor:null,this.targetXs=[];var e=this;this.selector.brush.on("brushend",function(){var i=e.selector.brush.extent(),n=[];t.each(e.axis.x.scale.domain(),function(t,s){var o=e.axis.x.scale(s),a=o+e.columnWidth;i[1]>=o&&a>=i[0]&&n.push(s)}),e.options.rangeselect&&n.length&&e.options.rangeselect(n),e.selector.brush.clear(),e.selector.container.call(e.selector.brush)})},r.prototype.eventData=function(t,e){return void 0===e?{x:t.x,y:t.y}:{x:t.x,y:t.y,g:e}},r.prototype.update=function(e){o.prototype.update.call(this,e);var i=this,n=this.chart.selectAll("g.pfi-chart-columns").data(this.data,function(t){return t.name});n.transition().duration(e).style("fill-opacity",1).style("stroke-opacity",1),n.enter().append("g").attr("class","pfi-chart-columns").style("fill",function(t){return t.color}).style("stroke","white").style("stroke-width",this.options.strokeWidth),n.exit().transition().duration(e).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove();var s=[];t.each(this.data,function(t,e){s.push(e.name)});var a=n.selectAll("rect").data(Object,function(t){return t.x});a.transition().duration(e).attr("x",function(t){return i.axis.x.scale(t.x)}).attr("y",function(t){return Math.min(i.axis.y.scale(t.y0),i.axis.y.scale(t.y0+t.y))}).style("fill-opacity","inherit").style("stroke-opacity","inherit").attr("width",this.columnWidth).attr("height",function(t){return Math.abs(i.axis.y.scale(t.y0)-i.axis.y.scale(t.y0+t.y))}),a.enter().append("rect").on("mouseover",function(t,e,n){(i.options.mouseover||i.options.click)&&d3.select(this).style("fill-opacity",.8),i.options.mouseover&&i.options.mouseover(i.eventData(t,s[n?n:0]))}).on("mouseout",function(t,e,n){d3.select(this).style("fill-opacity","inherit"),i.options.mouseout&&i.options.mouseout(i.eventData(t,s[n?n:0]))}).on("click",function(t,e,n){i.options.click&&i.options.click(i.eventData(t,s[n?n:0]))}).attr("x",function(t){return i.axis.x.scale(t.nx)}).attr("y",function(){return i.axis.y.scale(0)}).attr("width",this.columnWidth).attr("height",0).attr("fill",function(t){return i.columnColor?i.columnColor(t.x):"inherit"}).transition().duration(e).attr("x",function(t){return i.axis.x.scale(t.x)}).attr("y",function(t){return Math.min(i.axis.y.scale(t.y0),i.axis.y.scale(t.y0+t.y))}).attr("height",function(t){return Math.abs(i.axis.y.scale(t.y0)-i.axis.y.scale(t.y0+t.y))}),a.exit().transition().duration(e).attr("x",function(t){return i.axis.x.scale(t.x)}).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},r.prototype.updateDomain=function(){this.axis.x.scale.domain(this.targetXs),this.axis.y.scale.domain(d3.extent(d3.merge(d3.merge(this.data.map(function(t){return t.map(function(t){return[t.y0,t.y0+t.y]})}))))).nice()},r.prototype.updateRange=function(){this.axis.x.scale.rangeBands([0,this.innerSize.width],this.options.padding/2),this.axis.y.scale.range([this.innerSize.height,0]),this.columnWidth=this.axis.x.scale.rangeBand()},r.prototype.setData=function(e,i){var n={};this.data=this.convertData(e,i,function(t){return n[t.g]||(n[t.g]={}),"string"!=typeof t.x||"number"!=typeof t.y?"(x, y) is not (string, number)":n[t.g][t.x]?"x is duplicated":(n[t.g][t.x]=!0,!1)}),this.stackData(this.data,"x","y","y0","sum"),t.each(this.data,function(e,i){t.each(i,function(t,e){e.nx=e.x})});var s=this.options.sort?this.options.sort.match(/^y:(asc|desc)$/):null;this.targetXs=this.sliceData(this.data,s?"sum:"+s[1]:this.options.sort,"x",this.options.limit)},i.column=r;var l=function(t,i){o.call(this,t,e.extend({axis:{x:{scale:"ordinal",selectable:!!i.rangeselect},y:{scale:"linear"}},sort:"y:desc",limit:10,strokeWidth:1,pointSize:3,padding:1},i))};e.extend(l.prototype,o.prototype),l.prototype.build=function(){o.prototype.build.call(this),this.targetXs=[];var e=this;this.selector.brush.on("brushend",function(){var i=e.selector.brush.extent(),n=[];t.each(e.axis.x.scale.domain(),function(t,s){var o=e.axis.x.scale(s);o>=i[0]&&i[1]>=o&&n.push(s)}),e.options.rangeselect&&n.length&&e.options.rangeselect(n),e.selector.brush.clear(),e.selector.container.call(e.selector.brush)})},l.prototype.eventData=function(t,e){return void 0===e?{x:t.x,y:t.y}:{x:t.x,y:t.y,g:e}},l.prototype.update=function(e){o.prototype.update.call(this,e);var i=this,n=this.chart.selectAll("g.pfi-chart-lines").data(this.data,function(t){return t.name});n.transition().duration(e).style("fill-opacity",1).style("stroke-opacity",1),n.enter().append("g").attr("class","pfi-chart-lines").style("stroke",function(t){return t.color}).style("fill",function(t){return t.color}).style("fill-opacity",1e-6).style("stroke-width",this.options.strokeWidth).style("stroke-opacity",1e-6).transition().duration(e).style("fill-opacity",1).style("stroke-opacity",1),n.exit().transition().duration(e).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove();var s=n.selectAll("line").data(Object,function(t){return t.x});s.transition().duration(e).style("stroke-opacity","inherit").attr("x1",function(t){return i.axis.x.scale(t.x)}).attr("x2",function(t){return i.axis.x.scale(t.nx)}).attr("y1",function(t){return i.axis.y.scale(t.y)}).attr("y2",function(t){return i.axis.y.scale(t.ny)}),s.enter().append("line").attr("x1",function(t){return i.axis.x.scale(t.nx)}).attr("x2",function(t){return 2*i.axis.x.scale(t.nx)-i.axis.x.scale(t.x)}).attr("y1",function(){return i.axis.y.scale(0)}).attr("y2",function(){return i.axis.y.scale(0)}).style("stroke-opacity",1e-6).transition().duration(e).attr("x1",function(t){return i.axis.x.scale(t.x)}).attr("x2",function(t){return i.axis.x.scale(t.nx)}).attr("y1",function(t){return i.axis.y.scale(t.y)}).attr("y2",function(t){return i.axis.y.scale(t.ny)}).style("stroke-opacity","inherit"),s.exit().transition().duration(e).attr("x1",function(t){return i.axis.x.scale(t.x)}).attr("x2",function(t){return i.axis.x.scale(t.nx)}).style("stroke-opacity",1e-6).remove();var a=[];t.each(this.data,function(t,e){a.push(e.name)});var r=n.selectAll("circle").data(Object,function(t){return t.x});r.transition().duration(e).style("fill-opacity","inherit").attr("cx",function(t){return i.axis.x.scale(t.x)}).attr("cy",function(t){return i.axis.y.scale(t.y)}),r.enter().append("circle").on("mouseover",function(t,e,n){(i.options.mouseover||i.options.click)&&d3.select(this).style("stroke-opacity","inherit"),i.options.mouseover&&i.options.mouseover(i.eventData(t,a[n?n:0]))}).on("mouseout",function(t,e,n){d3.select(this).style("stroke-opacity",0),i.options.mouseout&&i.options.mouseout(i.eventData(t,a[n?n:0]))}).on("click",function(t,e,n){i.options.click&&i.options.click(i.eventData(t,a[n?n:0]))}).attr("r",this.options.pointSize/2).attr("cx",function(t){return i.axis.x.scale(t.nx)}).attr("cy",function(){return i.axis.y.scale(0)}).style("fill-opacity",1e-6).style("stroke-width",5).style("stroke-opacity",0).transition().duration(e).attr("cx",function(t){return i.axis.x.scale(t.x)}).attr("cy",function(t){return i.axis.y.scale(t.y)}).style("fill-opacity","inherit"),r.exit().transition().duration(e).attr("cx",function(t){return i.axis.x.scale(t.x)}).style("fill-opacity",1e-6).remove()},l.prototype.updateDomain=function(){this.axis.x.scale.domain(this.targetXs),this.axis.y.scale.domain(d3.extent(d3.merge(this.data.map(function(t){return t.map(function(t){return t.y})})))).nice()},l.prototype.updateRange=function(){this.axis.x.scale.rangePoints([0,this.innerSize.width],this.options.padding),this.axis.y.scale.range([this.innerSize.height,0])},l.prototype.setData=function(e,i){var n={};this.data=this.convertData(e,i,function(t){return n[t.g]||(n[t.g]={}),"string"!=typeof t.x||"number"!=typeof t.y?"(x, y) is not (string, number)":n[t.g][t.x]?"x is duplicated":(n[t.g][t.x]=!0,!1)});var s={};t.each(this.data,function(e,i){t.each(i,function(t,e){var i=e.x;(void 0===s[i]||e.y>s[i])&&(s[i]=e.y)})}),t.each(this.data,function(e,i){t.each(i,function(t,e){e.max=s[e.x]})});var o=this.options.sort?this.options.sort.match(/^y:(asc|desc)$/):null;this.targetXs=this.sliceData(this.data,o?"max:"+o[1]:this.options.sort,"x",this.options.limit),t.each(this.data,function(t,e){for(var i=0;e.length>i;++i)e[i].nx=i===e.length-1?e[i].x:e[i+1].x,e[i].ny=i===e.length-1?e[i].y:e[i+1].y})},i.line=l;var c=function(t,i){r.call(this,t,e.extend({axis:{x:{scale:"time"},y:{scale:"linear"}}},i))};e.extend(c.prototype,r.prototype),c.prototype.build=function(){r.prototype.build.call(this);var e=this;this.selector.brush.on("brushend",function(){var i=e.selector.brush.extent(),n={};e.chart.selectAll("rect").each(function(t){t.x<=i[1]&&i[0]<=t.nx&&(n[t.x]="["+s(t.x/1e3,10)+" to "+s(t.nx/1e3,10)+")")});var o=[];t.each(n,function(t,e){o.push(e)}),e.options.rangeselect&&o.length&&e.options.rangeselect(o),e.selector.brush.clear(),e.selector.container.call(e.selector.brush)
})},c.prototype.eventData=function(t,e){var i={x:"["+s(t.x/1e3,10)+" to "+s(t.nx/1e3,10)+")",y:t.y};return void 0!==e&&(i.g=e),i},c.prototype.updateDomain=function(){this.axis.x.scale.domain(d3.extent(d3.merge(d3.merge(this.data.map(function(t){return t.map(function(t){return[t.x,t.nx]})}))))),this.axis.y.scale.domain(d3.extent(d3.merge(d3.merge(this.data.map(function(t){return t.map(function(t){return[t.y0,t.y0+t.y]})}))))).nice()},c.prototype.updateRange=function(){this.axis.x.scale.range([0,this.innerSize.width]),this.axis.y.scale.range([this.innerSize.height,0]),this.data.length&&this.data[0].length&&(this.columnWidth=this.axis.x.scale(this.data[0][0].nx)-this.axis.x.scale(this.data[0][0].x))},c.prototype.setData=function(e,i){var n={};this.data=this.convertData(e,i,function(t){return n[t.g]||(n[t.g]={}),"string"==typeof t.x&&t.x.match(/^\[\d+ to \d+\)$/)&&"number"==typeof t.y?n[t.g][t.x]?"x is duplicated":(n[t.g][t.x]=!0,!1):"(x, y) is not (range-format string, number)"}),this.stackData(this.data,"x","y","y0","sum"),t.each(this.data,function(e,i){t.each(i,function(t,e){var i=e.x.match(/^\[(\d+) to (\d+)\)$/);e.x=new Date(1e3*s(i[1],10)),e.nx=new Date(1e3*s(i[2],10))})})},i["time-series-column"]=c;var u=function(t,i){l.call(this,t,e.extend({axis:{x:{scale:"time"},y:{scale:"linear"}}},i))};e.extend(u.prototype,l.prototype),u.prototype.build=function(){l.prototype.build.call(this);var e=this;this.selector.brush.on("brushend",function(){var i=e.selector.brush.extent(),n={};e.chart.selectAll("circle").each(function(t){i[0]<=t.x&&t.x<=i[1]&&(n[t.x]=s(t.x/1e3,10))});var o=[];t.each(n,function(t,e){o.push(e)}),e.options.rangeselect&&o.length&&e.options.rangeselect(o),e.selector.brush.clear(),e.selector.container.call(e.selector.brush)})},u.prototype.eventData=function(t,e){var i={x:s(t.x/1e3,10),y:t.y};return void 0!==e&&(i.g=e),i},u.prototype.updateDomain=function(){this.axis.x.scale.domain(d3.extent(d3.merge(this.data.map(function(t){return t.map(function(t){return t.x})})))),this.axis.y.scale.domain(d3.extent(d3.merge(this.data.map(function(t){return t.map(function(t){return t.y})})))).nice()},u.prototype.updateRange=function(){this.axis.x.scale.range([0,this.innerSize.width]),this.axis.y.scale.range([this.innerSize.height,0])},u.prototype.setData=function(e,i){var n={};this.data=this.convertData(e,i,function(t){return n[t.g]||(n[t.g]={}),"number"!=typeof t.x||"number"!=typeof t.y?"(x, y) is not (unixtime, number)":n[t.g][t.x]?"x is duplicated":(n[t.g][t.x]=!0,!1)}),t.each(this.data,function(e,i){t.each(i,function(t,e){e.x=new Date(1e3*s(e.x,10))})});var o=this;t.each(this.data,function(t,e){o.sortData(e,"x:asc");for(var i=0;e.length>i;++i)e[i].nx=i===e.length-1?e[i].x:e[i+1].x,e[i].ny=i===e.length-1?e[i].y:e[i+1].y})},i["time-series-line"]=u,e.bootstrap.define("chart",function(n,s){var o=e.extend({},t.fn.chart.defaults,s);if(!o.type)throw Error('Option "type" must be specified');if(!i[o.type])throw Error("Invalid chart type: "+o.type);var a=i[o.type];e.extend(this,a.prototype),a.call(this,n,o)},{})}(n,a),function(t,e){function i(i,n){var s=this.options=e.extend({},t.fn.counter.defaults,n);this.container=d3.select(i).append("div").style("font-family",s.font.family).style("font-size",s.font.size+"px").style("font-weight",s.font.weight)}e.extend(i.prototype,{setCount:function(t,e){var i=this.container.transition().duration(this.options.duration);i.tween("text",function(){var e=d3.interpolate(this.textContent.replace(/,/g,""),t);return function(t){var i=""+Math.round(e(t));this.textContent=i.replace(/\B(?=(?:\d{3})+$)/g,",")}}),e&&i.style("color",e)}}),e.bootstrap.define("counter",i,{duration:1e3,font:{family:"sans-serif",size:36,weight:"bold"}})}(n,a),function(t,e){function i(i,n){var s=this.$element=t(i),o=this.options=e.extend({},t.fn.timeline.defaults,n);this.$root=t("<div>").css({overflow:"scroll",height:s.height()}).appendTo(s),this.$tmpl=e.UI.$tmpl(o.template),this.data=[]}e.extend(i.prototype,{get:function(){var e=[];return this.$root.find(".pfi-timeline-chunk:not(.pfi-timeline-fadeout) .pfi-timeline-item").each(function(i,n){e.push(t(n).data())}),e},add:function(e){var i=t("<div>").addClass("pfi-timeline-chunk").prependTo(this.$root),n=this;t.each(e,function(t,e){n.$tmpl(e).data(e).addClass("pfi-timeline-item").appendTo(i)}),i.css({marginTop:-i.outerHeight(!0)+"px"}).animate({marginTop:0},this.options.duration,function(){n.$root.find(".pfi-timeline-item").slice(n.options.limit).remove(),n.$root.find(".pfi-timeline-chunk:not(:has(.pfi-timeline-item))").remove()})},clear:function(e){var i=void 0===e?this.options.duration:e;this.$root.find(".pfi-timeline-chunk").addClass("pfi-timeline-fadeout").fadeOut(i,function(){t(this).remove()}),this.data=[]}}),e.bootstrap.define("timeline",i,{limit:100,duration:1e3,template:"<div>example</div>"})}(n,a),function(t,i){function n(e,s){var o=this.$element=t(e),a=this.options=i.extend({},t.fn.pillcase.defaults,s);a.template={},a.template.$container=i.UI.$tmpl('<div class="pfi-pillcase-container"><ul class="pfi-pillcase-pills"></ul><div class="pfi-pillcase-resizer"></div></div>'),a.template.$suggestion=i.UI.$tmpl('<div class="pfi-pillcase-suggestion"><ul class="pfi-pillcase-suggest-items"/></div>'),a.template.$lockedPills=i.UI.$tmpl('{{#values}}<li class="pfi-pillcase-pill pfi-pillcase-locked-pill" data-value="{{.}}"><span>{{.}}</span></li>{{/values}}'),a.template.$editablePills=i.UI.$tmpl('{{#values}}<li class="pfi-pillcase-pill pfi-pillcase-editable-pill" data-value="{{.}}"><span>{{.}}</span><a tabindex="-1" href="#" class="pfi-pillcase-pill-remover">&times</a></li>{{/values}}'),a.template.$inputField=i.UI.$tmpl('<li class="pfi-pillcase-field"><textarea class="pfi-pillcase-input" style="width:1px;height:1px"></textarea></li>'),a.template.$suggestItems=i.UI.$tmpl('{{#values}}<li class="pfi-pillcase-suggest-item" data-value="{{.}}"><a tabindex="-1" href="#">{{.}}</a></li>{{/values}}'),a.values||(a.values=o.val()),a.lockedValues||(a.lockedValues=[]),a.lockedValues.length&&a.allowedValues&&(a.allowedValues=a.allowedValues.filter(function(t){return-1===a.lockedValues.indexOf(t)})),t.isFunction(a.source)&&(this.source=a.source),o.val("");var r=this.$container=a.template.$container(),l=this.formatter(a.values);this.options.template.$inputField().appendTo(r.find(".pfi-pillcase-pills")),this.setInputValues(l),this.setPillNodes(l),this.$resizer=r.find(".pfi-pillcase-resizer"),this.$suggestion=a.template.$suggestion(),this.closeSuggestion(),o.attr("tabindex",-1).addClass("pfi-pillcase-offscreen"),r.insertBefore(o).append(o),this.$suggestion.insertAfter(r),this.fitContainer(),n.once()}function s(e){return function(i){return a(i,e,t(i.target).closest(".pfi-pillcase-container"))}}function o(e){return function(i){return a(i,e,t(i.target).closest(".pfi-pillcase-suggestion").prev(".pfi-pillcase-container"))}}function a(t,e,i){return i.find("textarea.pfi-pillcase-offscreen").data("pillcase")[e](t)}n.once=function(){this.onceCalled||(this.onceCalled=!0,t(e).on("mousedown",".pfi-pillcase-container",s("stopEvent")).on("mousedown",".pfi-pillcase-suggest-item a",o("stopEvent")).on("keyup input","textarea.pfi-pillcase-input",s("keyupInput")).on("keydown","textarea.pfi-pillcase-input",s("keydownInput")).on("click","a.pfi-pillcase-pill-remover",s("clickPillRemover")).on("click",".pfi-pillcase-editable-pill",s("clickPill")).on("mouseenter",".pfi-pillcase-suggest-item a",o("mouseenterSuggestion")).on("click",".pfi-pillcase-suggest-item a",o("clickSuggestion")).on("focus","textarea.pfi-pillcase-input",s("focusInput")).on("blur","textarea.pfi-pillcase-input",s("blurInput")).on("click",".pfi-pillcase-container",s("focus")))},i.extend(n.prototype,{trigger:function(t,e){this.$element.trigger("pfi:pillcase:"+t,e)},values:function(){return this.cleaner(this.splitter(this.$element.val()))},splitter:function(t){return t.replace(/\r\n?/g,"\n").split(this.options.delimiter)},cleaner:function(e){return e.map(t.trim).filter(function(t){return t})},formatter:function(e){var i,n=this.cleaner(t.isArray(e)?e:this.splitter(e));return this.options.lockedValues.length&&(i=this.options.lockedValues,n=n.filter(function(t){return-1===i.indexOf(t)})),this.options.allowDuplication||(i=this.values(),n=n.filter(function(t){return-1===i.indexOf(t)})),this.options.allowedValues&&(i=this.options.allowedValues,n=n.filter(function(t){return-1!==i.indexOf(t)})),n},joiner:function(t){return t.join(this.options.glue||this.options.delimiter)},setInputValues:function(t){this.$element.val(this.joiner(t))},setPillNodes:function(t){var e=this.$container.find(".pfi-pillcase-field");this.$container.find(".pfi-pillcase-pill").remove(),this.createPillNodes(this.options.lockedValues,!0).insertBefore(e),this.createPillNodes(t).insertBefore(e)},changeValues:function(t){this.joiner(t)!==this.joiner(this.values())&&(this.setInputValues(t),this.trigger("change",[t]))},updateValues:function(){var e=t.map(this.$container.find(".pfi-pillcase-editable-pill"),function(e){return t(e).data("value")});this.changeValues(e)},setValues:function(t){t=this.formatter(t),this.setPillNodes(t),this.changeValues(t)},fitContainer:function(){var t=this.$element.width(),e=this.$container.find(".pfi-pillcase-field");this.$container.width(t),this.$resizer.css("max-width",t-e.outerWidth(!0)+e.width()+"px"),this.$suggestion.css("width",t+"px")},resizeInput:function(){var t=this.$container.find(".pfi-pillcase-input");this.$resizer.text(t.val()+"p"),t.width(this.$resizer.width()).height(this.$resizer.height())},createPillNodes:function(e,i){return e.length?this.options.template[i?"$lockedPills":"$editablePills"]({values:e}):t([])},createPills:function(t){return this.createPillNodes(this.formatter(t))},removePillNode:function(e){t(e).closest(".pfi-pillcase-pill").remove()},blurPill:function(e){var i=e?t(e):this.focusedPill();return i.removeClass("pfi-pillcase-pill-focus")},focusedPill:function(){return this.$container.find(".pfi-pillcase-pill-focus")},focusPill:function(e){return t(e).addClass("pfi-pillcase-pill-focus")},focusSiblingPill:function(e,i){var n=t(i)[e]("li.pfi-pillcase-editable-pill");return(n.length||"next"===e)&&this.blurPill(i),this.focusPill(n),n},removeFocusedPill:function(){var t=this.focusedPill();t.length?this.focusSiblingPill("prev",t):t=this.$container.find(".pfi-pillcase-field").prev("li.pfi-pillcase-editable-pill"),this.removePillNode(t),this.updateValues()},add:function(t){var e=this.createPills(t);e.length&&(e.insertBefore(this.$container.find(".pfi-pillcase-field")),this.updateValues())},openSuggestion:function(){var t=this.$container.position();this.$suggestion.css({top:t.top+this.$container.outerHeight(!0),left:t.left}).show(),this.shownSuggestion=!0},closeSuggestion:function(){this.$suggestion.hide(),this.shownSuggestion=!1,this.queryForSuggest=null},open:function(){var t=this.shownSuggestion;this.openSuggestion(),t||this.trigger("open")},close:function(){var t=this.shownSuggestion;this.closeSuggestion(),t&&this.trigger("close")},createSuggestion:function(t){var e=this.$suggestion.find(".pfi-pillcase-suggest-items").empty();this.options.template.$suggestItems({values:t}).appendTo(e)},blurSuggestion:function(e){var i=e?t(e):this.focusedSuggestion();return i.removeClass("pfi-pillcase-suggest-item-focus")},focusedSuggestion:function(){return this.$suggestion.find(".pfi-pillcase-suggest-item-focus")},focusSuggestion:function(e){return t(e).closest(".pfi-pillcase-suggest-item").addClass("pfi-pillcase-suggest-item-focus")},focusSiblingSuggestion:function(t){var e=this.focusedSuggestion(),i=e[t]("li.pfi-pillcase-suggest-item");return i.length||e.length&&!this.options.allowedValues||(i=this.$suggestion.find("li.pfi-pillcase-suggest-item:"+("prev"===t?"last":"first")+"-child")),this.blurSuggestion(),this.focusSuggestion(i),i},source:function(){return this.options.source},matcher:function(t){return~t.toLowerCase().indexOf(this.queryForSuggest.toLowerCase())},sorter:function(t){for(var e,i=[],n=[],s=[];e=t.shift();)e.toLowerCase().indexOf(this.queryForSuggest.toLowerCase())?~e.indexOf(this.queryForSuggest)?n.push(e):s.push(e):i.push(e);return i.concat(n,s)},lookup:function(e){var i=this,n=t.Deferred();if(e||(e=""),this.queryForSuggest=e,this.valuesForSuggest=this.values(),e.length<this.options.minLength)this.closeSuggestion(),setTimeout(function(){n.rejectWith(this)},0);else{var s=function(t){i.process(n,t)},o=this.source(this.query,s);o&&setTimeout(function(){s(o)},0)}return n},process:function(e,i){i=i.filter(t.proxy(this.matcher,this)),this.options.allowDuplication||(i=i.filter(t.proxy(function(t){return-1===this.valuesForSuggest.indexOf(t)},this))),this.options.allowedValues&&(i=i.filter(t.proxy(function(t){return-1!==this.options.allowedValues.indexOf(t)},this))),i=this.sorter(i),i.length?(this.createSuggestion(i.slice(0,this.options.items)),this.open(),e.resolveWith(this)):(this.close(),e.rejectWith(this))},stopEvent:function(t){t.preventDefault(),t.stopPropagation()},keyupInput:function(t){var e=this.$container.find(".pfi-pillcase-input"),i=e.val();switch(this.resizeInput(),t.keyCode){case 8:if(!i)return;break;case 9:case 13:case 27:case 37:case 38:case 39:case 40:return}this.focusedPill().length?this.close():this.queryForSuggest!==i&&this.lookup(i).done(function(){this.options.allowedValues&&this.focusSiblingSuggestion("next")})},keydownInput:function(t){var e=this.$container.find(".pfi-pillcase-input"),i=e.val();switch(t.keyCode){case 0:case 9:case 13:var n=this.focusedSuggestion();this.shownSuggestion&&n.length&&(i=n.data("value")),i&&this.add(i),0===t.keyCode||!i&&13!==t.keyCode||t.preventDefault(),e.val(""),this.resizeInput(),this.close();break;case 37:case 39:if(!i){var s=this.focusedPill();return s.length||(s=this.$container.find(".pfi-pillcase-field")),this.focusSiblingPill(37===t.keyCode?"prev":"next",s),this.keyupInput({keyCode:0}),void 0}break;case 38:case 40:var o=38===t.keyCode?"prev":"next";this.shownSuggestion?this.focusSiblingSuggestion(o):this.lookup(i).done(function(){this.focusSiblingSuggestion(o)});break;case 8:if(!i)return this.removeFocusedPill(),this.close(),void 0;break;case 27:this.close()}this.blurPill()},clickPillRemover:function(t){this.stopEvent(t),this.removePillNode(t.target),this.updateValues(),this.isFocusInput()&&this.focus()},clickPill:function(e){this.stopEvent(e),this.blurPill(),this.focusPill(t(e.target).closest(".pfi-pillcase-editable-pill")),this.$container.find(".pfi-pillcase-input").focus()},mouseenterSuggestion:function(t){this.blurSuggestion(),this.focusSuggestion(t.target)},clickSuggestion:function(t){this.stopEvent(t),this.keydownInput({keyCode:0})},blurInput:function(){var t=this.isFocusInput();this.close(),this.$container.removeClass("pfi-pillcase-focus"),this.keydownInput({keyCode:0}),t&&this.trigger("blur")},focusInput:function(){var t=this.isFocusInput();this.queryForSuggest=null,this.resizeInput(),this.$container.addClass("pfi-pillcase-focus"),this.keyupInput({keyCode:0}),t||this.trigger("focus")},isFocusInput:function(){return this.$container.hasClass("pfi-pillcase-focus")},blur:function(){this.$container.find(".pfi-pillcase-input").blur()},focus:function(){this.blurPill(),this.$container.find(".pfi-pillcase-input").focus()}}),i.bootstrap.define("pillcase",n,{glue:null,delimiter:" ",values:null,lockedValues:null,allowedValues:null,source:null,allowDuplication:!1,minLength:0,items:8})}(n,a),function(t,e){function i(i,n){this.$container=t(i);var s=this.options=e.extend({},t.fn.tagbox.defaults,n);this.$listTmpl=e.UI.$tmpl(s.listTemplate),this.$popoverTmpl=e.UI.$tmpl(s.popover.template);var o=this.tags_=[];t.each(s.tags,function(e,i){t.inArray(i,s.allowedTags)>=0&&o.push(i)}),this.listMode()}e.extend(i.prototype,{tags:function(){return this.tags_},isChanged:function(t){var e=t.slice().sort(),i=this.tags_.slice().sort();return!(e.length===i.length&&e.every(function(t,e){return i[e]===t}))},pillcaseMode:function(){var e=this;t("<textarea>").width(this.$container.width()).appendTo(this.$container.empty()).pillcase({values:e.tags_,allowedValues:this.options.allowedTags,source:this.options.allowedTags,minLength:1}).on("pfi:pillcase:blur",function(){var i=t(this).pillcase("values");e.isChanged(i)&&e.$container.trigger("pfi:tagbox:change",[i]),e.tags_=i,e.listMode()}).pillcase("focus")},listMode:function(){var i=this,n=this.$listTmpl({tags:this.tags_}).appendTo(this.$container.empty());n.find("li.pfi-tagbox-edit").click(function(t){t.preventDefault(),t.stopPropagation(),i.pillcaseMode()}),n.find("li.pfi-tagbox-tag").each(function(){var n=t(this),s=n.text(),o=i.options.traces[s]||[];n.popover({html:!0,trigger:"hover",placement:i.options.popover.placement,title:i.options.popover.title,content:i.$popoverTmpl({traces:o,hasTrace:!!o.length,formattedScore:function(){return e.text.sprintf(i.options.popover.scoreFormat,this.score)}})})})}}),e.bootstrap.define("tagbox",i,{tags:[],allowedTags:[],traces:{},listTemplate:['<ul class="pfi-tagbox">','{{#tags}}<li class="pfi-tagbox-tag">{{.}}</li>{{/tags}}','<li class="pfi-tagbox-edit"><a href="#">edit</a></li>',"</ul>"].join(""),popover:{placement:"top",title:"Top Features",scoreFormat:"%.3f",template:["{{#hasTrace}}",'<table class="table table-condensed">',"<thead>","<tr><th>Feature</th><th>Field</th><th>Score</th></tr>","</thead>","<tbody>","{{#traces}}","<tr><td>{{feature}}</td><td>{{field}}</td><td>{{formattedScore}}</td></tr>","{{/traces}}","</tbody>","</table>","{{/hasTrace}}","{{^hasTrace}}",'<p class="muted">No feature trace found</p>',"{{/hasTrace}}"].join("")}})}(n,a),a}(this,this.document,this.jQuery,this.jQuery,this.parseInt);